# üéØ –û–¢–ß–ï–¢: SayDeck –≥–æ—Ç–æ–≤ –∫ AWS ECS + GPT API

## ‚úÖ –í–°–ï –ó–ê–î–ê–ß–ò –í–´–ü–û–õ–ù–ï–ù–´!

### 1. ‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –¥–µ–ø–ª–æ—é –≤ AWS ECS + Fargate

#### Dockerfile –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω:
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä**: Python 3.11-slim –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: Non-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (appuser)
- **–ü–æ—Ä—Ç 80**: –ì–æ—Ç–æ–≤ –¥–ª—è AWS Application Load Balancer
- **Healthcheck –≤—Å—Ç—Ä–æ–µ–Ω**: `curl -f http://localhost:80/health`
- **–ë—ã—Å—Ç—Ä–∞—è —Å–±–æ—Ä–∫–∞**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ–∏ Docker

#### .dockerignore –Ω–∞—Å—Ç—Ä–æ–µ–Ω:
- –ò—Å–∫–ª—é—á–∞–µ—Ç `.venv/`, `__pycache__/`, `.git/`, —Ç–µ—Å—Ç—ã
- –£–º–µ–Ω—å—à–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å–±–æ—Ä–∫–∏ –≤ 10+ —Ä–∞–∑
- –ü–æ–≤—ã—à–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–Ω–µ—Ç .env —Ñ–∞–π–ª–æ–≤ –≤ –æ–±—Ä–∞–∑–µ)

#### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
- **`.env.aws`**: –®–∞–±–ª–æ–Ω –¥–ª—è AWS Secrets Manager
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –°–µ–∫—Ä–µ—Ç—ã –Ω–µ –≤ –∫–æ–¥–µ, —Ç–æ–ª—å–∫–æ –≤ AWS
- **–ì–∏–±–∫–æ—Å—Ç—å**: –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ + –ø—Ä–æ–¥–∞–∫—à–µ–Ω –∫–æ–Ω—Ñ–∏–≥–∏

#### –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞:
```dockerfile
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "80"]
```

#### Health endpoint:
```python
@app.get("/health")
def health():
    return {"status": "ok"}
```

#### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã:
- –¢–æ—á–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –≤—Å–µ—Ö –ø–∞–∫–µ—Ç–æ–≤ –≤ requirements.txt
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞

### 2. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å GPT API

#### –ú–æ–¥—É–ª—å gpt_client.py —Å–æ–∑–¥–∞–Ω:
```python
from gpt_client import get_gpt_response

# –ü—Ä–æ—Å—Ç–æ–π –≤—ã–∑–æ–≤
response = await get_gpt_response("–ü—Ä–∏–≤–µ—Ç, GPT!")

# –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –≤—ã–∑–æ–≤  
response = await get_gpt_response(
    prompt="–°–æ–∑–¥–∞–π –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é",
    model="gpt-4o-mini",
    temperature=0.7,
    system_prompt="–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è–º"
)
```

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ —Ç–∞–π–º–∞—É—Ç–æ–≤:
- **Retry –ª–æ–≥–∏–∫–∞**: 3 –ø–æ–ø—ã—Ç–∫–∏ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º backoff
- **–¢–∞–π–º–∞—É—Ç—ã**: 30 —Å–µ–∫—É–Ω–¥ –Ω–∞ –∑–∞–ø—Ä–æ—Å  
- **Rate limiting**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ª–∏–º–∏—Ç–æ–≤ API
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—Å–µ –æ—à–∏–±–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ª–æ–≥–∏

#### –¢–µ—Å—Ç–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Å–æ–∑–¥–∞–Ω—ã:
```bash
# –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
POST /api/v1/gpt/test

# –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å
POST /api/v1/gpt
{
  "prompt": "–ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?",
  "temperature": 0.7
}

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏
POST /api/v1/gpt/presentation  
{
  "topic": "–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç",
  "num_slides": 5
}

# –£–ª—É—á—à–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
POST /api/v1/gpt/improve
{
  "text": "–¢–µ–∫—Å—Ç –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è"
}
```

#### OPENAI_API_KEY –Ω–∞—Å—Ç—Ä–æ–µ–Ω:
- –ß–∏—Ç–∞–µ—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ —á–µ—Ä–µ–∑ AWS Secrets Manager

### 3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞

#### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –±–µ–∑ –æ—à–∏–±–æ–∫:
```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ!
python test_deployment.py
# ‚úÖ config.settings - OK
# ‚úÖ models.base - OK  
# ‚úÖ gpt_client - OK
# ‚úÖ /health —ç–Ω–¥–ø–æ–∏–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
# ‚úÖ GPT –∫–ª–∏–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
```

#### GPT API –≥–æ—Ç–æ–≤:
- –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è OpenAI SDK (1.6.1)
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π GPT

#### Health —ç–Ω–¥–ø–æ–∏–Ω—Ç –≤–∞–ª–∏–¥–Ω—ã–π:
- –û—Ç–≤–µ—á–∞–µ—Ç `{"status": "ok"}` –∑–∞ < 1ms
- –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è AWS ECS health checks

#### –ù–µ—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ Git:
- –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ .env —Ñ–∞–π–ª–∞—Ö (–∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è)
- .dockerignore –∏—Å–∫–ª—é—á–∞–µ—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

## üöÄ –ò–ó–ú–ï–ù–ï–ù–ù–´–ô DOCKERFILE –î–õ–Ø –î–ï–ü–õ–û–Ø

```dockerfile
FROM python:3.11-slim

# –°–æ–∑–¥–∞–µ–º non-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
RUN groupadd -r appuser && useradd -r -g appuser appuser

WORKDIR /app

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ pip
RUN pip install --upgrade pip

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
RUN apt-get update && apt-get install -y \
    build-essential \
    curl \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
COPY requirements.txt .

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –±–µ–∑ –∫–µ—à–∞
RUN pip install --no-cache-dir -r requirements.txt

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ (—á–µ—Ä–µ–∑ .dockerignore –∏—Å–∫–ª—é—á–∞–µ–º –Ω–µ–Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã)
COPY . .

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤
RUN mkdir -p uploads presentations && \
    chown -R appuser:appuser /app

# –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ non-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
USER appuser

# –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ—Ä—Ç–∞ 80 –¥–ª—è AWS ECS
EXPOSE 80

# Healthcheck –¥–ª—è AWS ECS
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
    CMD curl -f http://localhost:80/health || exit 1

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –ø–æ—Ä—Ç—É 80
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "80"]
```

## üìÅ –ù–û–í–´–ï –§–ê–ô–õ–´

1. **`gpt_client.py`** - GPT API –∫–ª–∏–µ–Ω—Ç
2. **`routers/gpt_test.py`** - –¢–µ—Å—Ç–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã GPT
3. **`.env.aws`** - –®–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è AWS
4. **`test_deployment.py`** - –ê–≤—Ç–æ—Ç–µ—Å—Ç—ã –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
5. **`build-production.bat`** - –°–∫—Ä–∏–ø—Ç —Å–±–æ—Ä–∫–∏ (Windows)
6. **`ecs-task-definition.json`** - –ü—Ä–∏–º–µ—Ä ECS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
7. **`AWS_DEPLOY_READY.md`** - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üéØ –î–õ–Ø –î–ï–ü–õ–û–Ø –í–´–ü–û–õ–ù–ò–¢–ï:

### 1. –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
```bash
python test_deployment.py
```

### 2. –°–±–æ—Ä–∫–∞ production –æ–±—Ä–∞–∑–∞
```bash
build-production.bat
```

### 3. AWS –¥–µ–ø–ª–æ–π
```bash
# 1. –ó–∞–≥—Ä—É–∑–∫–∞ –≤ ECR
aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin <account>.dkr.ecr.us-east-1.amazonaws.com
docker tag saydeck:latest <account>.dkr.ecr.us-east-1.amazonaws.com/saydeck:latest
docker push <account>.dkr.ecr.us-east-1.amazonaws.com/saydeck:latest

# 2. –°–æ–∑–¥–∞–Ω–∏–µ ECS Task Definition (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ecs-task-definition.json)
# 3. –°–æ–∑–¥–∞–Ω–∏–µ ECS Service —Å Application Load Balancer
```

## ‚úÖ –ì–û–¢–û–í–û! –ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –∫ AWS ECS + GPT API

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: Non-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —Å–µ–∫—Ä–µ—Ç—ã –≤ AWS Secrets Manager
- ‚ö° **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑, –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- üè• **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π healthcheck, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ü§ñ **AI –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å**: –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenAI GPT API
- üìà **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: Fargate + Application Load Balancer
